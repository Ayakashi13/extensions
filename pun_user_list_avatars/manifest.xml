<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE extension SYSTEM "ext-1.0.dtd">

	<extension engine="1.0">
	<id>pun_user_list_avatars</id>
	<title>Avatars in User List</title>	
	<version>1.1</version>
	<description>Option to display users' avatars in User List is added.</description>
	<author>PunBB Development Team</author>
	
	<minversion>1.3 SVN</minversion>
	<maxtestedon>1.3 SVN</maxtestedon>
	
	<note type="install">This is official mod for PunBB 1.3. It displays users' avatars in User List menu. Please read Readme file or visit our official website http://punbb.org</note>

	<hooks>
	
		<hook id="hd_userlist_head">
		<![CDATA[
			echo '<link rel="stylesheet" type="text/css" media="screen" href="'.$ext_info['url'].'/style.css" />';
		]]>
		</hook>
	
		<hook id="ul_start">
		<![CDATA[
			if (file_exists($ext_info['path'].'/lang/'.$forum_user['language'].'/'.$ext_info['id'].'.php'))
				require $ext_info['path'].'/lang/'.$forum_user['language'].'/'.$ext_info['id'].'.php';
			else
				require $ext_info['path'].'/lang/English/'.$ext_info['id'].'.php';
		
		]]>
		</hook>
	
		<hook id="ul_table_header_after_username">
		<![CDATA[
	    
			if ($forum_user['show_avatars'] == 1)
			{
				$cell_width = $forum_config['o_avatars_width'] + 10;
				$cell_height = $forum_config['o_avatars_height'] + 20;
				echo "\t\t\t\t\t\t".'<th class="tc1" scope="col" width="'.$cell_width.'">'.$lang_avatar_in_user_list['Column name'].'</th>'."\n";
			}
	
		]]>
		</hook>
		
		<hook id="ul_table_contents_after_username">
		<![CDATA[
		
			if ($forum_user['show_avatars'] == 1)
			{
				
				echo "\t\t\t\t\t\t".'<td class="tc1" height="'.$cell_height.'">';
				
				$avatar = $forum_config['o_avatars_dir'].'/'.$user_data['id'];
				$arr = array('.gif', '.jpg', '.png');
				$file_avatar = FALSE;
				
				for ($format = 0; $format < count( $arr ); $format++)
					if (file_exists( $avatar.$arr[ $format ] ))
					{
						$file_avatar = $avatar.$arr[ $format ];
						break;
					}
				
				if ($file_avatar)
				{
					$size = getimagesize($file_avatar);
					echo '<a href="'.(($forum_user['g_id'] == FORUM_ADMIN) ? forum_link($forum_url['profile_avatar'], $user_data['id']) : forum_link($forum_url['user'], $user_data['id'])).'"><img src="'.$file_avatar.'" border="0" '.$size[3].' /></a>';
				}
				else
				{
					echo '<a href="'.(($forum_user['g_id'] == FORUM_ADMIN) ? forum_link($forum_url['profile_avatar'], $user_data['id']) : forum_link($forum_url['user'], $user_data['id'])).'">'.$lang_avatar_in_user_list['No avatar'].'</a>';				
				}
			echo '</td>'."\n";
			}
		]]>
		</hook>

	</hooks>
	</extension>